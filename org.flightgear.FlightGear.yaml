id: org.flightgear.FlightGear
runtime: org.kde.Platform
runtime-version: 5.11
sdk: org.kde.Sdk
command: flightgear.sh
rename-icon: flightgear
finish-args:
- --socket=wayland
- --share=ipc
- --socket=x11
- --device=dri
- --socket=pulseaudio
- --share=network
- --persist=~/.fgfs/
build-options:
  cflags: -O2
  cxxflags: -O2
cleanup:
- /include
- /lib/pkgconfig
- /lib64/pkgconfig
- /lib/cmake
- /share/doc
- /share/ffmpeg
- /share/man
- "*.h"
- "*.a"
- "*.la"
- "*.cmake"
modules:
- name: boost
  buildsystem: simple
  build-commands:
  - ./bootstrap.sh --prefix=/app
  - ./b2 headers
  - ./b2 install
  sources:
  sources:
  - type: archive
    url: https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.bz2
    sha256: 7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7
  cleanup:
  - /include
  
- shared-modules/glu/glu-9.0.0.json

- name: mesa
  config-opts:
  - --enable-osmesa
  sources:
  - type: archive
    url: https://mesa.freedesktop.org/archive/mesa-18.1.7.tar.xz
    sha256: 655e3b32ce3bdddd5e6e8768596e5d4bdef82d0dd37067c324cc4b2daa207306

- name: ffmpeg
  config-opts:
  - --disable-everything
  - --enable-shared
  # Enough to run the base game, might need extending for mod content 
  - --enable-decoder=bink,binkaudio_rdft,mp3,pcm_s16le,vorbis
  - --enable-demuxer=bink,mp3,ogg,pcm_s16le,wav
  sources:
  - type: archive
    url: http://ffmpeg.org/releases/ffmpeg-4.0.2.tar.xz
    sha256: a95c0cc9eb990e94031d2183f2e6e444cc61c99f6f182d1575c433d62afb2f97
    
- name: openscenegraph
  buildsystem: cmake-ninja
  config-opts:
  - -DCMAKE_BUILD_TYPE=Release
  sources:
  - type: archive
    url: https://github.com/openscenegraph/OpenSceneGraph/archive/OpenSceneGraph-3.4.1.tar.gz
    sha256: 930eb46f05781a76883ec16c5f49cfb29a059421db131005d75bec4d78401fd5
  - type: shell
    commands:
    - sed 's|SET(LIB_POSTFIX "64" CACHE|SET(LIB_POSTFIX "" CACHE|' -i CMakeLists.txt
    - sed 's|DGifCloseFile(giffile)|DGifCloseFile(giffile,0)|' -i src/osgPlugins/gif/ReaderWriterGIF.cpp
    
- name: simgear
  buildsystem: cmake-ninja
  config-opts:
  - -DCMAKE_BUILD_TYPE=Release
  sources:
  - type: archive
    url: https://sourceforge.net/projects/flightgear/files/release-2018.2/simgear-2018.2.2.tar.bz2
    sha256: f61576bc36aae36f350154749df1cee396763604c06b8a71c4b50452d9151ce5
    
- name: xmu
  sources:
  - type: archive
    url: https://www.x.org/archive//individual/lib/libXmu-1.1.2.tar.bz2
    sha256: 756edc7c383254eef8b4e1b733c3bf1dc061b523c9f9833ac7058378b8349d0b
    
- name: plib
  sources:
  - type: archive
    url: http://plib.sourceforge.net/dist/plib-1.8.5.tar.gz
    sha256: 485b22bf6fdc0da067e34ead5e26f002b76326f6371e2ae006415dea6a380a32
    
- name: flightgear-data
  buildsystem: simple
  sources:
  - type: archive
    url: https://sourceforge.net/projects/flightgear/files/release-2018.2/FlightGear-2018.2.2-data.tar.bz2
    sha256: c89b94e4cf3cb7eda728daf6cca6dd051f7a47863776c99fd2f3fe0054400ac4
    dest: fgdata
  build-commands:
  - mkdir --parents /app/share/flightgear
  - mv fgdata/* /app/share/flightgear/
    
- name: flightgear
  buildsystem: cmake-ninja
  config-opts:
  - -DENABLE_QT=ON
  - -DCMAKE_BUILD_TYPE=Release
  - -DFG_BUILD_TYPE=Release
  builddir: true
  sources:
  - type: archive
    url: https://sourceforge.net/projects/flightgear/files/release-2018.2/flightgear-2018.2.2.tar.bz2
    sha256: 61f809ef0a3f6908d156f0c483ed5313d31b5a6ac74761955d0b266751718147
  - type: file
    path: org.flightgear.FlightGear.appdata.xml
  - type: file
    path: flightgear.sh
  build-commands:
  - install -Dm644 ../org.flightgear.FlightGear.appdata.xml /app/share/appdata/org.flightgear.FlightGear.appdata.xml
  - install -Dm744 ../flightgear.sh /app/bin/flightgear.sh
  - chmod +x /app/bin/flightgear.sh
  post-install:
  - desktop-file-edit --set-key=Exec --set-value=flightgear.sh /app/share/applications/org.flightgear.FlightGear.desktop
  - desktop-file-edit --set-key=StartupWMClass --set-value=osgViewer /app/share/applications/org.flightgear.FlightGear.desktop
